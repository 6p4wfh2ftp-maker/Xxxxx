<!doctype html>
<html lang="ro">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Randare fațadă (cu stil din altă poză)</title>
  <style>
    :root{
      --bg:#0b0c10;
      --panel:#11131a;
      --ink:#e9eef7;
      --muted:#aab4c3;
      --line:#222738;
      --btn:#1f2937;
      --accent:#3b82f6;
      --danger:#ef4444;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
      background:var(--bg);
      color:var(--ink);
    }
    .bar{
      position:sticky;top:0;z-index:5;
      padding:14px 16px;
      background:#0f1118;
      border-bottom:1px solid var(--line);
      display:flex;justify-content:space-between;align-items:center;
      gap:12px;
    }
    .title{font-weight:800}
    .wrap{max-width:1200px;margin:0 auto;padding:16px}
    .grid{display:grid;grid-template-columns: 420px 1fr; gap:14px}
    @media (max-width: 980px){ .grid{grid-template-columns:1fr} }
    .card{
      background:var(--panel);
      border:1px solid var(--line);
      border-radius:14px;
      padding:14px;
      box-shadow:0 10px 30px rgba(0,0,0,.25);
    }
    .h{font-weight:800;margin:0 0 10px}
    label{display:block;font-size:13px;color:var(--muted);margin:10px 0 6px}
    input[type=file], textarea{
      width:100%;
      background:#0f1118;
      color:var(--ink);
      border:1px solid var(--line);
      border-radius:12px;
      padding:10px;
      outline:none;
    }
    textarea{min-height:120px;resize:vertical}
    .row{display:flex;gap:10px;margin-top:12px;flex-wrap:wrap}
    .btn{
      border:1px solid var(--line);
      background:var(--btn);
      color:var(--ink);
      padding:10px 14px;
      border-radius:12px;
      font-weight:700;
      cursor:pointer;
    }
    .btn.primary{background:var(--accent); border-color:#2b63c9}
    .btn.danger{background:#7f1d1d; border-color:#5b1414}
    .status{margin-top:10px;font-size:13px;color:var(--muted);white-space:pre-wrap}
    .rules{margin-top:10px;font-size:12px;color:var(--muted);line-height:1.35}
    .resultBox{
      width:100%;
      min-height:420px;
      border-radius:14px;
      border:1px solid var(--line);
      background:#0f1118;
      display:flex;align-items:center;justify-content:center;
      overflow:hidden;
    }
    .resultBox img{width:100%;height:auto;display:none}
    .placeholder{color:var(--muted);padding:18px;text-align:center}
  </style>
</head>
<body>
  <div class="bar">
    <div class="title">Randare fațadă (cu stil din altă poză)</div>
    <div class="row">
      <button class="btn" id="saveBtn" type="button">Salvează / Share</button>
      <button class="btn danger" id="clearBtn" type="button">Șterge tot</button>
    </div>
  </div>

  <div class="wrap">
    <div class="grid">
      <div class="card">
        <h3 class="h">1) Poze + micro-corecții</h3>

        <label>1. Poză principală (casa reală) <b>(obligatoriu)</b></label>
        <input id="mainImage" type="file" accept="image/*" required />

        <label>2. Poză de inspirație / stil <b>(opțional)</b></label>
        <input id="styleImage" type="file" accept="image/*" />

        <label>3. Micro-corecții (opțional)</label>
        <textarea id="micro" placeholder="Ex: coloane corintice subțiri, ancadramente simple, fără chei de boltă, culori capucino, etc."></textarea>

        <div class="row">
          <button class="btn primary" id="goBtn" type="button">Randare AI</button>
          <button class="btn danger" id="clearBtn2" type="button">Șterge tot</button>
        </div>

        <div class="status" id="status">Gata ✅</div>

        <div class="rules">
          <b>Reguli:</b><br>
          • Imaginea 1 = structură FIXĂ (nu se schimbă).<br>
          • Imaginea 2 = doar stil/ornamente de copiat (nu devine clădirea).<br>
          • Dacă rezultatul schimbă structura, repetă randarea și/sau adaugă micro-corecții.
        </div>
      </div>

      <div class="card">
        <h3 class="h">Rezultat</h3>
        <div class="resultBox">
          <div class="placeholder" id="ph">Se va afișa aici randarea.</div>
          <img id="out" alt="Rezultat randare" />
        </div>
      </div>
    </div>
  </div>

<script>
/** ✅ PUNE AICI URL-UL WORKER-ULUI TĂU (Cloudflare Workers) */
const WORKER_URL = "https://fatada-render.6p4wfh2ftp.workers.dev/";

/** Prompt general (automat) — valabil pentru ORICE fațadă */
const BASE_PROMPT = `
IMPORTANT:
This is a REAL EXISTING HOUSE photo.
Do NOT change the structure.

STRICT RULES:
– Do NOT modify volume, floors, roof shape, slab, pillars position
– Do NOT move, resize or add windows or doors
– Do NOT add balconies, terraces or extra roofs
– Do NOT redesign the house

TASK:
Visually APPLY classical decorative elements on the EXISTING facade only.

Decorative elements to apply:
– classical attached columns (flat / semi-flat, NOT free-standing)
– window and door frames (ancadramente simple, elegant)
– horizontal decorative band (brau) between floors
– classical cornice under the roof

STYLE:
Elegant classical / neoclassical
Clean, realistic, buildable in real life.

GOAL:
Photorealistic facade visualization that keeps the original house 100% unchanged,
only with applied decorative profiles.

If structure is changed → result is INVALID.
`.trim();

const mainInput  = document.getElementById("mainImage");
const styleInput = document.getElementById("styleImage");
const microEl    = document.getElementById("micro");
const goBtn      = document.getElementById("goBtn");
const statusEl   = document.getElementById("status");
const outImg     = document.getElementById("out");
const ph         = document.getElementById("ph");

const clear = () => {
  mainInput.value = "";
  styleInput.value = "";
  microEl.value = "";
  outImg.src = "";
  outImg.style.display = "none";
  ph.style.display = "block";
  statusEl.textContent = "Gata ✅";
};

document.getElementById("clearBtn").addEventListener("click", clear);
document.getElementById("clearBtn2").addEventListener("click", clear);

document.getElementById("saveBtn").addEventListener("click", async () => {
  if (!outImg.src) {
    alert("Nu există un rezultat de salvat încă.");
    return;
  }
  // deschide imaginea într-un tab nou (de acolo o poți salva/share pe iOS)
  window.open(outImg.src, "_blank");
});

goBtn.addEventListener("click", async () => {
  try {
    const mainFile  = mainInput.files[0];
    const styleFile = styleInput.files[0]; // poate fi undefined

    if (!mainFile) {
      alert("Încarcă poza principală (casa reală)!");
      return;
    }

    // prompt final: prompt general + micro-corecții
    const micro = (microEl.value || "").trim();
    const finalPrompt = micro ? (BASE_PROMPT + "\n\nMICRO-CORRECTIONS:\n" + micro) : BASE_PROMPT;

    statusEl.textContent = "Se generează...";
    ph.style.display = "block";
    outImg.style.display = "none";
    outImg.src = "";

    // ✅ CHEILE CORECTE:
    // - "image" = poza principală (obligatoriu)
    // - "style" = poza de inspirație (opțional)
    // - "prompt" = prompt final
    const fd = new FormData();
    fd.append("image", mainFile);            // IMPORTANT: exact "image"
    if (styleFile) fd.append("style", styleFile);
    fd.append("prompt", finalPrompt);

    const r = await fetch(WORKER_URL, {
      method: "POST",
      body: fd
    });

    if (!r.ok) {
      const t = await r.text();
      statusEl.textContent = "Eroare: " + r.status + " / " + t;
      return;
    }

    const blob = await r.blob();
    const url = URL.createObjectURL(blob);
    outImg.src = url;
    outImg.style.display = "block";
    ph.style.display = "none";
    statusEl.textContent = "Gata ✅";
  } catch (e) {
    statusEl.textContent = "Eroare: " + (e?.message || String(e));
  }
});
</script>
</body>
</html>
